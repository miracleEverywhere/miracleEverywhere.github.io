import{f as V,u as W,h as X,i as Z,j as ee,t as se,k as le,l as D,m as b,p as e,q as te,s as ae,v as re,R as I,x as oe,y as ie,z as ce,A as ue,B as ne,C as T,D as M,E as de,F as me,G as he,H as ve,L as pe,I as ye,J as fe,K as ge,M as O,N as qe,O as w}from"./app-CEi3r2_h.js";const ke=["/","/docs/","/docs/dashboard.html","/docs/import.html","/docs/install.html","/docs/logs.html","/docs/platform.html","/docs/rooms.html","/docs/ui.html","/docs/users.html","/faq/","/faq/group.html","/docs/install/","/docs/install/bin.html","/docs/install/docker.html","/docs/install/win11.html","/docs/tools/","/docs/tools/announce.html","/docs/tools/backup.html","/docs/tools/map.html","/docs/tools/snapshot.html","/docs/tools/token.html","/quick-start/","/quick-start/firewall.html","/quick-start/install.html","/quick-start/server.html","/quick-start/setting.html","/quick-start/token.html","/faq/dmp/","/faq/dmp/app.html","/faq/dmp/forget-password.html","/faq/dmp/migrate.html","/faq/dmp/multi-server.html","/faq/dmp/port.html","/faq/dmp/update-dmp.html","/faq/dmp/update-dst.html","/faq/dst/","/faq/dst/connection-code.html","/faq/dst/same-name.html","/docs/setting/","/docs/setting/mod.html","/docs/setting/player.html","/docs/setting/room.html","/404.html"],He="SLIMSEARCH_QUERY_HISTORY",f=O(He,[]),be=()=>{const{queryHistoryCount:a}=w;return{enabled:a>0,queryHistories:f,addQueryHistory:c=>{f.value=Array.from(new Set([c,...f.value.slice(0,a-1)]))},removeQueryHistory:c=>{f.value=[...f.value.slice(0,c),...f.value.slice(c+1)]}}},$=a=>ke[a.id]+("anchor"in a?`#${a.anchor}`:""),we="SLIMSEARCH_RESULT_HISTORY",{resultHistoryCount:j}=w,g=O(we,[]),xe=()=>({enabled:j>0,resultHistories:g,addResultHistory:i=>{{const c={link:$(i),display:i.display};"header"in i&&(c.header=i.header),g.value=[c,...g.value.slice(0,j-1)]}},removeResultHistory:i=>{g.value=[...g.value.slice(0,i),...g.value.slice(i+1)]}}),Re=a=>{const{page:i,routeLocale:c}=de(),x=me(),r=D(0),q=b(()=>r.value>0),d=he([]);return ve(()=>{const{search:R,terminate:v}=pe(),k=fe(p=>{const{resultsFilter:Q=t=>t,querySplitter:y,suggestionsFilter:A,...o}=x.value;p?(r.value+=1,R(p,c.value,o).then(t=>Q(t,p,c.value,i.value)).then(t=>{r.value-=1,d.value=t}).catch(t=>{console.warn(t),r.value-=1,r.value||(d.value=[])})):d.value=[]},w.searchDelay-w.suggestDelay,{maxWait:5e3});ye([a,c],([p])=>k(p.join(" "))),ge(()=>{v()})}),{isSearching:q,results:d}};var Se=V({name:"SearchResult",props:{queries:{type:Array,required:!0},isFocusing:Boolean},emits:["close","updateQuery"],setup(a,{emit:i}){const c=W(),x=X(),r=Z(ee),{addQueryHistory:q,queryHistories:d,removeQueryHistory:R}=be(),{resultHistories:v,addResultHistory:k,removeResultHistory:p}=xe(),Q=se(a,"queries"),{results:y,isSearching:A}=Re(Q),o=le({isQuery:!0,index:0}),t=D(0),m=D(0),E=b(()=>d.value.length>0||v.value.length>0),S=b(()=>y.value.length>0),C=b(()=>y.value[t.value]||null),U=()=>{const{isQuery:s,index:l}=o;l===0?(o.isQuery=!s,o.index=s?v.value.length-1:d.value.length-1):o.index=l-1},_=()=>{const{isQuery:s,index:l}=o;l===(s?d.value.length-1:v.value.length-1)?(o.isQuery=!s,o.index=0):o.index=l+1},P=()=>{t.value=t.value>0?t.value-1:y.value.length-1,m.value=C.value.contents.length-1},Y=()=>{t.value=t.value<y.value.length-1?t.value+1:0,m.value=0},B=()=>{m.value<C.value.contents.length-1?m.value+=1:Y()},z=()=>{m.value>0?m.value-=1:P()},L=s=>s.map(l=>qe(l)?l:e(l[0],l[1])),G=s=>{if(s.type==="customField"){const l=ue[s.index]||"$content",[h,u=""]=ne(l)?l[x.value].split("$content"):l.split("$content");return s.display.map(n=>e("div",L([h,...n,u])))}return s.display.map(l=>e("div",L(l)))},H=()=>{t.value=0,m.value=0,i("updateQuery",""),i("close")},J=()=>e("div",{class:"slimsearch-records"},e("div",{class:"slimsearch-record"},[e("div",{class:"slimsearch-record-title"},r.value.queryHistory),e("ul",{class:"slimsearch-record-contents",role:"listbox"},d.value.map((s,l)=>{const h=o.isQuery&&o.index===l;return e("li",{class:["slimsearch-record-matches",{active:h}],role:"option","aria-selected":h,onClick:()=>{i("updateQuery",s)}},e("div",[e(T,{class:"slimsearch-record-type"}),e("div",{class:"slimsearch-record-content"},s),e("button",{type:"button",class:"slimsearch-remove-icon",title:r.value.remove,"aria-label":r.value.remove,innerHTML:M,onClick:u=>{u.preventDefault(),u.stopPropagation(),R(l)}})]))}))])),K=()=>e("ul",{class:"slimsearch-records"},e("li",{class:"slimsearch-record"},[e("div",{class:"slimsearch-record-title"},r.value.resultHistory),e("ul",{class:"slimsearch-record-contents",role:"listbox"},v.value.map((s,l)=>{const h=!o.isQuery&&o.index===l;return e("li",{class:["slimsearch-record-matches",{active:h}],role:"option","aria-selected":h},e(I,{to:s.link,onClick:()=>{H()}},()=>[e(T,{class:"slimsearch-record-type"}),e("div",{class:"slimsearch-record-content"},[s.header?e("div",{class:"slimsearch-record-content-header"},s.header):null,e("div",s.display.map(u=>L(u)).flat())]),e("button",{type:"button",class:"slimsearch-remove-icon",title:r.value.remove,"aria-label":r.value.remove,innerHTML:M,onClick:u=>{u.preventDefault(),u.stopPropagation(),p(l)}})]))}))]));return te("keydown",s=>{if(a.isFocusing){if(S.value){if(s.key==="ArrowUp")z();else if(s.key==="ArrowDown")B();else if(s.key==="Enter"){const l=C.value.contents[m.value];q(a.queries.join(" ")),k(l),c.push($(l)),H()}}else if(s.key==="ArrowUp")U();else if(s.key==="ArrowDown")_();else if(s.key==="Enter"){const{index:l}=o;o.isQuery?(s.preventDefault(),i("updateQuery",d.value[l])):(c.push(v.value[l].link),H())}}}),ae([t,m],()=>{document.querySelector(".slimsearch-record.active .slimsearch-record-matches.active")?.scrollIntoView(!1)},{flush:"post"}),()=>e("div",{id:"slimsearch-results",class:["slimsearch-result-wrapper",{empty:a.queries.length?!S.value:!E.value}]},a.queries.length?A.value?e(re,{hint:r.value.searching}):S.value?e("div",{class:"slimsearch-records",role:"listbox","aria-labeledby":"slimsearch-label"},y.value.map(({title:s,contents:l},h)=>{const u=t.value===h;return e("div",{class:["slimsearch-record",{active:u}],role:"group","aria-selected":u},[e("div",{class:"slimsearch-record-title"},s||r.value.defaultTitle),e("ul",{class:"slimsearch-record-contents"},l.map((n,N)=>{const F=u&&m.value===N;return e("li",{class:["slimsearch-record-matches",{active:F}],role:"option","aria-selected":F},e(I,{to:$(n),onClick:()=>{q(a.queries.join(" ")),k(n),H()}},()=>[n.type==="text"?null:e(n.type==="title"?oe:n.type==="heading"?ie:ce,{class:"slimsearch-record-type"}),e("div",{class:"slimsearch-record-content"},[n.type==="text"&&n.header?e("div",{class:"slimsearch-record-content-header"},n.header):null,e("div",G(n))])]))}))])})):r.value.emptyResult:E.value?[J(),K()]:r.value.emptyHistory)}});export{Se as default};
